<div class="container py-4" *ngIf="user">

  <!-- ======== REQUEST BUTTON ======== -->
  <div class="d-flex justify-content-center mb-4">
    <button (click)="submitRequest()"
      class="btn btn-primary btn-lg shadow rounded-pill d-flex align-items-center px-5 py-3">
      <i class="bi bi-door-open-fill me-2 fs-4"></i>
      <span class="fw-semibold fs-5">Request Exit</span>
    </button>
  </div>

  <!-- ======== WELCOME ======== -->
  <div class="text-center mb-4">
    <p class="text-muted fs-5">Welcome, <span class="fw-bold">{{ user?.Name ?? '' }}</span></p>
  </div>

  <!-- ======== PERSONAL INFO ======== -->
  <div class="card shadow-sm border-0 rounded-4 mb-4">
    <div class="card-header bg-primary text-white text-center fw-semibold rounded-top-4">
      Personal & Job Information
    </div>
    <div class="card-body">
      <div class="row text-center g-3">

        <div class="col-6 col-md-4">
          <h6 class="text-muted"><i class="bi bi-building"></i> Department</h6>
          <span class="badge bg-secondary fs-6 px-3 py-2">{{ user?.DeptName ?? '' }}</span>
        </div>

        <div class="col-6 col-md-4">
          <h6 class="text-muted"><i class="bi bi-person-badge"></i> Role</h6>
          <span class="badge bg-secondary fs-6 px-3 py-2">{{ user?.RoleName ?? '' }}</span>
        </div>

        <div class="col-6 col-md-4">
          <h6 class="text-muted"><i class="bi bi-clock"></i> Clock Hours</h6>
          <span class="badge bg-secondary fs-6 px-3 py-2">8</span>
        </div>

      </div>

      <hr>

      <div class="row text-center g-3">

        <div class="col-6 col-md-3">
          <h6 class="text-muted"><i class="bi bi-envelope"></i> Email</h6>
          <span class="badge bg-light text-dark fs-6 px-3 py-2">{{ user?.Email ?? '' }}</span>
        </div>

        <div class="col-6 col-md-3">
          <h6 class="text-muted"><i class="bi bi-calendar-check"></i> Join Date</h6>
          <span class="badge bg-light text-dark fs-6 px-3 py-2">{{ user?.StartDate | date:'mediumDate' }}</span>
        </div>

        <div class="col-6 col-md-3">
          <h6 class="text-muted"><i class="bi bi-calendar-x"></i> End Date</h6>
          <span class="badge bg-light text-dark fs-6 px-3 py-2">{{ user?.EndDate | date:'mediumDate' }}</span>
        </div>

        <div class="col-6 col-md-3">
          <h6 class="text-muted"><i class="bi bi-patch-check"></i> Status</h6>
          <span class="badge bg-success fs-6 px-3 py-2">Active</span>
        </div>

      </div>
    </div>
  </div>

  <!-- ======== SALARY DETAILS ======== -->
  <div class="card shadow-sm border-0 rounded-4 mb-4">
    <div class="card-header bg-primary text-white text-center fw-semibold rounded-top-4">
      Salary Details
    </div>
    <div class="card-body">
      <div class="row text-center g-3">

        <div class="col-6 col-md-3">
          <h6 class="text-muted"><i class="bi bi-cash-stack"></i> Base Salary</h6>
          <span class="badge bg-secondary fs-6 px-3 py-2">{{ latestSal?.BaseSalary ?? '' | currency:'USD' }}</span>
        </div>

        <div class="col-6 col-md-3">
          <h6 class="text-muted"><i class="bi bi-wallet2"></i> Deduction</h6>
          <span class="badge bg-danger fs-6 px-3 py-2">{{ latestSal?.Deduction ?? '' | currency:'USD' }}</span>
        </div>

        <div class="col-6 col-md-3">
          <h6 class="text-muted"><i class="bi bi-gift"></i> Bonus</h6>
          <span class="badge bg-warning text-dark fs-6 px-3 py-2">0</span>
        </div>

        <div class="col-6 col-md-3">
          <h6 class="text-muted"><i class="bi bi-piggy-bank"></i> Total</h6>
          <span class="badge bg-primary fs-6 px-3 py-2">{{ latestSal?.NetSalary ?? '' | currency:'USD' }}</span>
        </div>

      </div>
    </div>
    <div class="card-footer text-center">
      <button class="btn btn-outline-primary px-4" (click)="salDetails()">Show Details</button>
    </div>
  </div>

  <!-- ======== WORKING / PRESENT / ABSENT ======== -->
  <div class="row g-3 justify-content-center mb-4">

    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 rounded-4 text-center p-3">
        <h6 class="text-muted"><i class="bi bi-alarm"></i> Worked Hours</h6>
        <span class="badge bg-secondary fs-6 px-3 py-2">{{ user?.workingHours ?? '' }} / {{ user.expectedWorkHours }}</span>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 rounded-4 text-center p-3">
        <h6 class="text-muted"><i class="bi bi-check-circle"></i> Present Days</h6>
        <span class="badge bg-primary fs-6 px-3 py-2">{{ presentDayCount }}</span>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 rounded-4 text-center p-3">
        <h6 class="text-muted"><i class="bi bi-x-circle"></i> Absent Days</h6>
        <span class="badge bg-danger fs-6 px-3 py-2">{{ absentDayCount }}</span>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 rounded-4 text-center p-3">
        <button class="btn btn-success w-100 py-2" (click)="openAttendacePage()">
          Show Details <i class="bi bi-arrow-right ms-1"></i>
        </button>
      </div>
    </div>

  </div>

<!-- ======== LEAVE REQUESTS ======== -->
<div class="card shadow-sm rounded-4">
  <div class="card-header bg-primary text-white text-center fw-semibold rounded-top-4">
    My Leave Requests
  </div>

  <div class="card-body">

    <div *ngIf="requests.length === 0" class="text-center text-muted fs-5">
      No requests found.
    </div>

    <table *ngIf="requests.length > 0" class="table table-hover text-center">
      <thead class="table-light">
        <tr>
          <th>Type</th>
          <th>Date</th>
          <th>End / Time</th>
          <th>Reason</th>
          <th>Status</th>
          <th>Review By</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let req of requests">
          <td>{{ req.Type }}</td>
          <td>{{ req.StartDate | date:'MMM dd, yyyy' }}</td>
          <td>
            <span *ngIf="req.EndDate">
              {{ req.EndDate | date:'MMM dd, yyyy' }}
            </span>
            <span *ngIf="!req.EndDate">
              {{ req.FromTime | date:'hh:mm a' }} - {{ req.ToTime | date:'hh:mm a' }}
            </span>
          </td>
          <td>{{ req.Reason }}</td>
          <td>{{ req.Status }}</td>
          <td><span class="badge bg-primary">{{ req.ApprovedByName }}</span></td>
        </tr>
      </tbody>
    </table>

    <!-- ======== LEAVE HOURS SUMMARY ======== -->
    <div class="row mt-4 g-3 justify-content-center">
      <div class="col-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center p-3">
          <h6 class="text-muted">Legal Hours</h6>
          <span class="badge bg-info fs-6 px-3 py-2">{{ legalUsedHours }} / 112</span>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card shadow-sm border-0 rounded-4 text-center p-3">
          <h6 class="text-muted">Sick Hours</h6>
          <span class="badge bg-warning text-dark fs-6 px-3 py-2">{{ sickUsedHours }} / 112</span>
        </div>
      </div>
    </div>

  </div>
</div>


</div>

<!-- LOADING -->
<div class="text-center mt-5" *ngIf="!user">
  <div class="spinner-border text-primary"></div>
</div>
